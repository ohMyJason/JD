<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="css/details.css" rel="stylesheet">
    <link href="css/layui.css" rel="stylesheet">
    <script src="js/jquery-3.4.1.min.js"></script>
    <script src="js/layui.js"></script>
    <script>
        $(function() {
            var $yin = $(".yin");
            $(".Ul li img").mouseover(function () {
                $(this).parent().addClass("li").siblings().removeClass("li");
                $("#pian").attr("src", $(this).attr("src"));
                $("#zhao").attr("src", $(this).attr("src"));
            }).mouseout(function () {
                $(this).parent().removeClass("li");
            });
            var l = $(".shang").eq(0).offset().left;
            var t = $(".shang").eq(0).offset().top;
            var width1 = $(".yin").outerWidth() / 2;
            var height1 = $(".yin").outerHeight() / 2;
            var maxL = $(".shang").width() - $yin.outerWidth();
            var maxT = $(".shang").height() - $yin.outerHeight();
            var bili = $("#zhao").width() / $("#pian").width();
            $(".shang").mousemove(function (e) {
                var maskL = e.clientX - l - width1,
                    maskT = e.clientY - t - height1;
                if (maskL < 0) {
                    maskL = 0
                }
                ;
                if (maskT < 0) {
                    maskT = 0
                }
                ;
                if (maskL > maxL) {
                    maskL = maxL
                }
                ;
                if (maskT > maxT) {
                    maskT = maxT
                }
                ;
                $yin.css({
                    "left": maskL,
                    "top": maskT
                });
                $(".xia").show();
                $(".yin").show();
                $("#zhao").css({
                    "margin-left": -maskL * bili,
                    "margin-top": -maskT * bili
                });
            });
            $(".shang").mouseleave(function () {
                $(".xia").hide();
                $(".yin").hide();
            });
            var marginLeft = 0;
            $(".you").click(function () {
                marginLeft = marginLeft - 64;
                if (marginLeft < -64) {
                    marginLeft = -64
                }
                ;
                $(".tab ul").stop().animate({
                        "margin-left": marginLeft
                    },
                    "fast");
            });
            $(".zuo").click(function () {
                marginLeft = marginLeft + 64;
                if (marginLeft > 0) {
                    marginLeft = 0
                }
                ;
                $(".tab ul").stop().animate({
                        "margin-left": marginLeft
                    },
                    "fast");
            });
            $(".lie li").click(function () {
                var index = $(this).index();
                $(this).addClass("ll").siblings().removeClass("ll");
                $(".bao1>div").eq(index).show().siblings().hide();
            });
            $("input[value='+']").click(function () {
                $(this).prev().val(parseInt($(this).prev().val()) + 1);
                $("input[name='num']").trigger("input");
            });
            $("input[value='-']").click(function () {
                var $num = parseInt($(this).next().val());
                if ($num > 1) {
                    $(this).next().val($num - 1);
                    $("input[name='num']").trigger("input");
                } else {
                    $(this).closest("ul").find("span").click();
                }
            });
            $("input[type='submit']").click(function () {
                $.ajax({
                    url: "/user/insertComment",
                    type: "post",
                    data: {
                        commentDetail: $("textarea[name='message']").val(),
                        commentLevel: $("input[name='level']").val(),
                        productItemId:$("input[name='productid']").val(),
                        userId:$("input[name='userid']").val(),

                    },
                    datatype: "json",
                    success: function (result) {
                        if (result.code==0) {
                            alert("插入成功")
                            // location.reload();
                        } else {
                            alert("插入失败")
                        }
                    }
                })
            })
            $.ajax({
                url:"/user/showCommentByProductId",
                type:"post",
                datatype:"json",
                scriptCharset:"utf-8",
                data:{productId:"1"},
                success:function (result) {
                    for(var i=0;i<result.data.length;i++){
                        var $node = $("div[class='article']:eq(0)").clone(true);
                        $node.children().eq(0).text("用户："+result.data[i].userId);
                        $node.children().eq(1).text("评论："+result.data[i].commentDetail);
                        // $node.children().eq(0).children().text("评论："+"#");
                        $node.children().eq(2).text("星级："+result.data[i].commentLevel);
                        $node.children().eq(4).text("商品："+result.data[i].productItemId);
                        $("div[class='down']").prepend($node);
                    }
                }
            })
                $.ajax({
                    url:"/user/detailPage",
                        type:"post",
                        datatype:"json",
                        scriptCharset:"utf-8",
                        data:{
                            userId:"3",
                            productId:"1"
                        },
                        success:function (result) {
                            // var $name = result.data[0].productName;
                            $("div[class='name']").text(result.data[0].productName);
                            $("div[class='address']").append(result.data[2][0].address);
                            $(".price span").eq(1).html(result.data[0].productPrice);
                            $("div[class='business']").text("由"+result.data[0].businessName+"配送");
                            $(".lie li").eq(1).text("评论("+result.data[0].commentCount+")")
                            //下面是图片路径
                            // alert(result.data[1][0]);
                            // $img = result.data[1][0]
                            // $("#pian").attr("src", $img);
                            // $(".UL  li img").attr("src", $img);
                            // $("#zhao").attr("src", $img);
                        }
                })
        })
    </script>
</head>
<body>
<div>
    <div class="da ">

        <div class="shang">

            <img src="images/details/details1.jpg" height="350" width="350" id="pian" />

            <div class="yin"></div>

        </div>

        <div class="bao">

            <span class="zuo"></span>

            <div class="tab">

                <ul class="Ul">

                    <li><img src="images/details/details1.jpg" height="52" width="52" /></li>
                    <li><img src="images/details/details2.jpg" height="52" width="52" /></li>
                    <li><img src="images/details/details3.jpg" height="52" width="52" /></li>
                    <li><img src="images/details/details4.jpg" height="52" width="52" /></li>
                    <li><img src="images/details/details5.jpg" height="52" width="52" /></li>
                    <li><img src="images/details/details6.jpg" height="52" width="52" /></li>

                </ul>

            </div>

            <span class="you"></span>

        </div>
        <div class="wrap">
            <div class="name">
                水密码 化妆品女 洗面奶 补水 保湿 深层清洁 冰川矿泉 套装系列 洁肤晶露100g                </div>
            <div class="summary">
                <div class="dt">京东价</div>
                <div class="dd">
                                <span class="price">
                                    <span>￥</span>
                                    <span>29.90</span>
                                </span>
                </div>
                <div class="address">配送至：</div>
                <div class="business"></div>
                <div class="btns">
                    <ul>
                        <li class="num"><input type="button" value="-" style="width: 20px"> <input name="num" type="text" value="1" size="5px"> <input type="button" value="+" style="width: 20px">
                            <button class="layui-btn layui-btn-warm"><a href="cart.html">加入购物车</a></button>
                        </li>

                    </ul>

                </div>
            </div>
        </div>
        <div class="lie ">

            <ul>

                <li class="ll">图文介绍</li>

                <li>评论</li>

            </ul>

        </div>

        <div class="nie">

            <div class="bao1">

                <div class="up">

                    <span>暂无好评！</span>

                    <p>适用浏览器：IE8、360、FireFox、Chrome、Safari、Opera、傲游、搜狗、世界之窗</p>

                    <p>来源：师徒课堂</p>

                </div>

                <div class="down">

                    <div class="article">
                        <div class="author">用户:张三<span>12#</span></div>
                        <div class="content">测试一下</div>
                        <div class="leval">星级:2</div>
                        <div class="time page">发表于:2019-02-09 13:12:23</div>
                        <div class="pid">1</div>
                    </div>
                    <div>
                        <form>
                            <div class="msg">
                                <textarea name="message" rows="5" cols="72"></textarea>
                                <input name="level" value="1">
                                <input name="userid" value="3">
                                <input name="productid" value="2">
                            </div>
                            <div align="center"><input type="reset" value="清除"/> <input type="submit" value="发表"/></div>
                        </form>
                    </div>
                </div>
<!--                    <div class="page">-->
<!--                        <input class="btn1" type="button" value="上一页" onClick="">-->
<!--                        <input class="btn1" type="button" value="下一页" onClick="">-->
<!--                    </div><br>-->

            </div>

        </div>

    </div>

    <div class="xia">

        <img src="images/details/details1.jpg" height="600" width="600" id="zhao" />

    </div>
    <div id="test"></div>
</div>
</body>
</html>